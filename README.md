Goè¯­è¨€ä»é›¶å®ç°
---

å‚è€ƒï¼šhttps://geektutu.com/post/gee.html


## 1 Webæ¡†æ¶ron-web

åœ¨è®¾è®¡ä¸€ä¸ªæ¡†æ¶ä¹‹å‰ï¼Œéœ€è¦å›ç­”æ¡†æ¶æ ¸å¿ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚



`net/http`æä¾›äº†åŸºç¡€çš„WebåŠŸèƒ½ï¼Œå³ç›‘å¬ç«¯å£ï¼Œæ˜ å°„é™æ€è·¯ç”±ï¼Œè§£æHTTPæŠ¥æ–‡ã€‚ä¸€äº›Webå¼€å‘ä¸­ç®€å•çš„éœ€æ±‚å¹¶ä¸æ”¯æŒï¼Œéœ€è¦æ‰‹å·¥å®ç°ã€‚

- åŠ¨æ€è·¯ç”±ï¼šä¾‹å¦‚`hello/:name`ï¼Œ`hello/*`è¿™ç±»çš„è§„åˆ™ã€‚
- é‰´æƒï¼šæ²¡æœ‰åˆ†ç»„/ç»Ÿä¸€é‰´æƒçš„èƒ½åŠ›ï¼Œéœ€è¦åœ¨æ¯ä¸ªè·¯ç”±æ˜ å°„çš„handlerä¸­å®ç°ã€‚
- æ¨¡æ¿ï¼šæ²¡æœ‰ç»Ÿä¸€ç®€åŒ–çš„HTMLæœºåˆ¶ã€‚
- â€¦

å½“æˆ‘ä»¬ç¦»å¼€æ¡†æ¶ï¼Œ**ä½¿ç”¨åŸºç¡€åº“æ—¶ï¼Œéœ€è¦é¢‘ç¹æ‰‹å·¥å¤„ç†çš„åœ°æ–¹**ï¼Œå°±æ˜¯æ¡†æ¶çš„ä»·å€¼æ‰€åœ¨ã€‚

- è·¯ç”±(Routing)ï¼šå°†è¯·æ±‚æ˜ å°„åˆ°å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ã€‚ä¾‹å¦‚`'/hello/:name`ã€‚
- æ¨¡æ¿(Templates)ï¼šä½¿ç”¨å†…ç½®æ¨¡æ¿å¼•æ“æä¾›æ¨¡æ¿æ¸²æŸ“æœºåˆ¶ã€‚
- å·¥å…·é›†(Utilites)ï¼šæä¾›å¯¹ cookiesï¼Œheaders ç­‰å¤„ç†æœºåˆ¶ã€‚
- æ’ä»¶(Plugin)ï¼šBottleæœ¬èº«åŠŸèƒ½æœ‰é™ï¼Œä½†æä¾›äº†æ’ä»¶æœºåˆ¶ã€‚å¯ä»¥é€‰æ‹©å®‰è£…åˆ°å…¨å±€ï¼Œä¹Ÿå¯ä»¥åªé’ˆå¯¹æŸå‡ ä¸ªè·¯ç”±ç”Ÿæ•ˆã€‚
- â€¦



### å‰ç½®çŸ¥è¯†

#### æ ‡å‡†åº“å¯åŠ¨WebæœåŠ¡



#### å®ç°http.Handleræ¥å£



### ä¸Šä¸‹æ–‡

å°†è·¯ç”±(router)ç‹¬ç«‹

- è®¾è®¡`ä¸Šä¸‹æ–‡(Context)`ï¼Œå°è£… Request å’Œ Response ï¼Œæä¾›å¯¹ JSONã€HTML ç­‰è¿”å›ç±»å‹çš„æ”¯æŒã€‚







### å‰ç¼€æ ‘è·¯ç”±



åŠ¨æ€è·¯ç”±ï¼Œå³ä¸€æ¡è·¯ç”±è§„åˆ™å¯ä»¥åŒ¹é…æŸä¸€ç±»å‹è€ŒéæŸä¸€æ¡å›ºå®šçš„è·¯ç”±ã€‚

åŠ¨æ€è·¯ç”±æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæ”¯æŒçš„è§„åˆ™ã€æ€§èƒ½ç­‰æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚ä¾‹å¦‚å¼€æºçš„è·¯ç”±å®ç°`gorouter`æ”¯æŒåœ¨è·¯ç”±è§„åˆ™ä¸­åµŒå…¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚`/p/[0-9A-Za-z]+`ï¼Œå³è·¯å¾„ä¸­çš„å‚æ•°ä»…åŒ¹é…æ•°å­—å’Œå­—æ¯ï¼›å¦ä¸€ä¸ªå¼€æºå®ç°`httprouter`å°±ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚è‘—åçš„Webå¼€æºæ¡†æ¶`gin` åœ¨æ—©æœŸçš„ç‰ˆæœ¬ï¼Œå¹¶æ²¡æœ‰å®ç°è‡ªå·±çš„è·¯ç”±ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº†`httprouter`ï¼Œåæ¥ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæ”¾å¼ƒäº†`httprouter`ï¼Œè‡ªå·±å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ã€‚

å®ç°åŠ¨æ€è·¯ç”±æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œè¢«ç§°ä¸º**==å‰ç¼€æ ‘(Trieæ ‘)==**ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ‹¥æœ‰ç›¸åŒçš„å‰ç¼€ã€‚





```
curl "http://localhost:9999/login" -X POST -d 'username=geektutu&password=1234'
```



### åˆ†ç»„æ§åˆ¶

#### åˆ†ç»„çš„æ„ä¹‰

åˆ†ç»„æ§åˆ¶(Group Control)æ˜¯ Web æ¡†æ¶åº”æä¾›çš„åŸºç¡€åŠŸèƒ½ä¹‹ä¸€ã€‚æ‰€è°“åˆ†ç»„ï¼Œæ˜¯æŒ‡è·¯ç”±çš„åˆ†ç»„ã€‚å¦‚æœæ²¡æœ‰è·¯ç”±åˆ†ç»„ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªè·¯ç”±è¿›è¡Œæ§åˆ¶ã€‚ä½†æ˜¯çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€æŸä¸€ç»„è·¯ç”±éœ€è¦ç›¸ä¼¼çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼š

- ä»¥`/post`å¼€å¤´çš„è·¯ç”±åŒ¿åå¯è®¿é—®ã€‚
- ä»¥`/admin`å¼€å¤´çš„è·¯ç”±éœ€è¦é‰´æƒã€‚
- ä»¥`/api`å¼€å¤´çš„è·¯ç”±æ˜¯ RESTful æ¥å£ï¼Œå¯ä»¥å¯¹æ¥ç¬¬ä¸‰æ–¹å¹³å°ï¼Œéœ€è¦ä¸‰æ–¹å¹³å°é‰´æƒã€‚



#### åˆ†ç»„åµŒå¥—



### ä¸­é—´ä»¶

==ä¸­é—´ä»¶(middlewares)==å°±æ˜¯**éä¸šåŠ¡çš„æŠ€æœ¯ç±»ç»„ä»¶**ã€‚Webæ¡†æ¶æœ¬èº«ä¸å¯èƒ½å»ç†è§£æ‰€æœ‰çš„ä¸šåŠ¡ï¼Œå› è€Œä¸å¯èƒ½å®ç°æ‰€æœ‰çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦æœ‰ä¸€ä¸ª**æ’å£**ï¼Œå…è®¸**ç”¨æˆ·è‡ªå·±å®šä¹‰åŠŸèƒ½**ï¼ŒåµŒå…¥åˆ°æ¡†æ¶ä¸­ï¼Œä»¿ä½›è¿™ä¸ªåŠŸèƒ½æ˜¯æ¡†æ¶åŸç”Ÿæ”¯æŒçš„ä¸€æ ·ã€‚å› æ­¤ï¼Œå¯¹ä¸­é—´ä»¶è€Œè¨€ï¼Œéœ€è¦è€ƒè™‘2ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹ï¼š

- **æ’å…¥ç‚¹**åœ¨å“ªï¼Ÿä½¿ç”¨æ¡†æ¶çš„äººå¹¶ä¸å…³å¿ƒåº•å±‚é€»è¾‘çš„å…·ä½“å®ç°ï¼Œå¦‚æœæ’å…¥ç‚¹å¤ªåº•å±‚ï¼Œä¸­é—´ä»¶é€»è¾‘å°±ä¼šéå¸¸å¤æ‚ã€‚å¦‚æœæ’å…¥ç‚¹ç¦»ç”¨æˆ·å¤ªè¿‘ï¼Œé‚£å’Œç”¨æˆ·ç›´æ¥å®šä¹‰ä¸€ç»„å‡½æ•°ï¼Œæ¯æ¬¡åœ¨ Handler ä¸­æ‰‹å·¥è°ƒç”¨æ²¡æœ‰å¤šå¤§çš„ä¼˜åŠ¿äº†ã€‚
- ä¸­é—´ä»¶çš„**è¾“å…¥**æ˜¯ä»€ä¹ˆï¼Ÿä¸­é—´ä»¶çš„è¾“å…¥ï¼Œå†³å®šäº†æ‰©å±•èƒ½åŠ›ã€‚æš´éœ²çš„å‚æ•°å¤ªå°‘ï¼Œç”¨æˆ·å‘æŒ¥ç©ºé—´æœ‰é™ã€‚



### æ¨¡æ¿(HTML Template)

#### æœåŠ¡ç«¯æ¸²æŸ“

å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œå³ Web åç«¯æä¾› RESTful æ¥å£ï¼Œè¿”å›ç»“æ„åŒ–çš„æ•°æ®(é€šå¸¸ä¸º JSON æˆ–è€… XML)ã€‚å‰ç«¯ä½¿ç”¨ AJAX æŠ€æœ¯è¯·æ±‚åˆ°æ‰€éœ€çš„æ•°æ®ï¼Œåˆ©ç”¨ JavaScript è¿›è¡Œæ¸²æŸ“ã€‚Vue/React ç­‰å‰ç«¯æ¡†æ¶æŒç»­ç«çƒ­ï¼Œè¿™ç§å¼€å‘æ¨¡å¼å‰åç«¯è§£è€¦ï¼Œä¼˜åŠ¿éå¸¸çªå‡ºã€‚

- åç«¯ä¸“å¿ƒè§£å†³èµ„æºåˆ©ç”¨ï¼Œå¹¶å‘ï¼Œæ•°æ®åº“ç­‰é—®é¢˜ï¼Œåªéœ€è¦è€ƒè™‘æ•°æ®å¦‚ä½•ç”Ÿæˆï¼›å‰ç«¯ç«¥é‹ä¸“æ³¨äºç•Œé¢è®¾è®¡å®ç°ï¼Œåªéœ€è¦è€ƒè™‘æ‹¿åˆ°æ•°æ®åå¦‚ä½•æ¸²æŸ“å³å¯ã€‚

- å‰åç«¯åˆ†ç¦»å¦å¤–ä¸€ä¸ªä¼˜åŠ¿ã€‚å› ä¸ºåç«¯åªå…³æ³¨äºæ•°æ®ï¼Œæ¥å£è¿”å›å€¼æ˜¯ç»“æ„åŒ–çš„ï¼Œä¸å‰ç«¯è§£è€¦ã€‚åŒä¸€å¥—åç«¯æœåŠ¡èƒ½å¤ŸåŒæ—¶æ”¯æ’‘å°ç¨‹åºã€ç§»åŠ¨APPã€PCç«¯ Web é¡µé¢ï¼Œä»¥åŠå¯¹å¤–æä¾›çš„æ¥å£ã€‚éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„ä¸æ–­åœ°å‘å±•ï¼ŒWebpackï¼Œgulp ç­‰å·¥å…·å±‚å‡ºä¸ç©·ï¼Œå‰ç«¯æŠ€æœ¯è¶Šæ¥è¶Šè‡ªæˆä½“ç³»äº†ã€‚

å‰ååˆ†ç¦»çš„ä¸€å¤§é—®é¢˜ï¼Œé¡µé¢æ˜¯åœ¨å®¢æˆ·ç«¯æ¸²æŸ“çš„ï¼Œæ¯”å¦‚æµè§ˆå™¨ï¼Œè¿™**å¯¹äºçˆ¬è™«å¹¶ä¸å‹å¥½**ã€‚Google çˆ¬è™«å·²ç»èƒ½å¤Ÿçˆ¬å–æ¸²æŸ“åçš„ç½‘é¡µï¼Œä½†æ˜¯çŸ­æœŸå†…çˆ¬å–æœåŠ¡ç«¯ç›´æ¥æ¸²æŸ“çš„ HTML é¡µé¢ä»æ˜¯ä¸»æµã€‚

#### é™æ€æ–‡ä»¶(Serve Static Files)



#### HTML æ¨¡æ¿æ¸²æŸ“



### é”™è¯¯æ¢å¤



## 2 åˆ†å¸ƒå¼ç¼“å­˜ron-cache

> å•†ä¸šä¸–ç•Œé‡Œï¼Œç°é‡‘ä¸ºç‹ï¼›æ¶æ„ä¸–ç•Œé‡Œï¼Œç¼“å­˜ä¸ºç‹ã€‚

### ä¸ºä»€ä¹ˆ

ç›´æ¥ä½¿ç”¨é”®å€¼å¯¹ï¼ˆ`map`ï¼‰ç¼“å­˜æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

1. å†…å­˜ä¸å¤Ÿäº†æ€ä¹ˆåŠï¼Ÿ

é‚£å°±éšæœºåˆ æ‰å‡ æ¡æ•°æ®å¥½äº†ã€‚éšæœºåˆ æ‰å¥½å‘¢ï¼Ÿè¿˜æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºå¥½å‘¢ï¼Ÿæˆ–è€…æ˜¯æœ‰æ²¡æœ‰å…¶ä»–æ›´å¥½çš„æ·˜æ±°ç­–ç•¥å‘¢ï¼Ÿä¸åŒæ•°æ®çš„è®¿é—®é¢‘ç‡æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼˜å…ˆåˆ é™¤è®¿é—®é¢‘ç‡ä½çš„æ•°æ®æ˜¯ä¸æ˜¯æ›´å¥½å‘¢ï¼Ÿæ•°æ®çš„è®¿é—®é¢‘ç‡å¯èƒ½éšç€æ—¶é—´å˜åŒ–ï¼Œé‚£ä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘è®¿é—®çš„æ•°æ®å¯èƒ½æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚

éœ€è¦å®ç°ä¸€ä¸ª**==åˆç†çš„æ·˜æ±°ç­–ç•¥==**ã€‚

2. å¹¶å‘å†™å…¥å†²çªäº†æ€ä¹ˆåŠï¼Ÿ

å¯¹ç¼“å­˜çš„è®¿é—®ï¼Œä¸€èˆ¬ä¸å¯èƒ½æ˜¯ä¸²è¡Œçš„ã€‚map æ˜¯æ²¡æœ‰å¹¶å‘ä¿æŠ¤çš„ï¼Œåº”å¯¹å¹¶å‘çš„åœºæ™¯ï¼Œä¿®æ”¹æ“ä½œ(åŒ…æ‹¬æ–°å¢ï¼Œæ›´æ–°å’Œåˆ é™¤)éœ€è¦åŠ é”ã€‚

3. å•æœºæ€§èƒ½ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ

å•å°è®¡ç®—æœºçš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œè®¡ç®—ã€å­˜å‚¨ç­‰éƒ½æ˜¯æœ‰é™çš„ã€‚éšç€ä¸šåŠ¡é‡å’Œè®¿é—®é‡çš„å¢åŠ ï¼Œå•å°æœºå™¨å¾ˆå®¹æ˜“é‡åˆ°ç“¶é¢ˆã€‚å¦‚æœåˆ©ç”¨å¤šå°è®¡ç®—æœºçš„èµ„æºï¼Œå¹¶è¡Œå¤„ç†æé«˜æ€§èƒ½å°±è¦ç¼“å­˜åº”ç”¨èƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼ï¼Œè¿™ç§°ä¸º**æ°´å¹³æ‰©å±•(scale horizontally)**ã€‚ä¸æ°´å¹³æ‰©å±•ç›¸å¯¹åº”çš„æ˜¯**å‚ç›´æ‰©å±•(scale vertically)**ï¼Œå³é€šè¿‡å¢åŠ å•ä¸ªèŠ‚ç‚¹çš„è®¡ç®—ã€å­˜å‚¨ã€å¸¦å®½ç­‰ï¼Œæ¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œç¡¬ä»¶çš„æˆæœ¬å’Œæ€§èƒ½å¹¶éå‘ˆçº¿æ€§å…³ç³»ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ**åˆ†å¸ƒå¼ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªæ›´ä¼˜çš„é€‰æ‹©ã€‚

### æ˜¯ä»€ä¹ˆ

è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼Œéœ€è¦è€ƒè™‘**èµ„æºæ§åˆ¶ã€æ·˜æ±°ç­–ç•¥ã€å¹¶å‘ã€åˆ†å¸ƒå¼èŠ‚ç‚¹é€šä¿¡**ç­‰å„ä¸ªæ–¹é¢çš„é—®é¢˜ã€‚è€Œä¸”ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œè¿˜éœ€è¦åœ¨ä¸åŒçš„ç‰¹æ€§ä¹‹é—´æƒè¡¡ï¼Œä¾‹å¦‚ï¼Œæ˜¯å¦éœ€è¦æ”¯æŒç¼“å­˜æ›´æ–°ï¼Ÿè¿˜æ˜¯å‡å®šç¼“å­˜åœ¨æ·˜æ±°ä¹‹å‰æ˜¯ä¸å…è®¸æ”¹å˜çš„ã€‚ä¸åŒçš„æƒè¡¡å¯¹åº”ç€ä¸åŒçš„å®ç°ã€‚



### LRUç¼“å­˜æ·˜æ±°ç­–ç•¥





### å•æœºå¹¶å‘ç¼“å­˜





### HTTPæœåŠ¡ç«¯



åˆ†å¸ƒå¼ç¼“å­˜éœ€è¦å®ç°èŠ‚ç‚¹é—´é€šä¿¡ï¼Œå»ºç«‹åŸºäº HTTP çš„é€šä¿¡æœºåˆ¶æ˜¯æ¯”è¾ƒå¸¸è§å’Œç®€å•çš„åšæ³•ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å¯åŠ¨äº† HTTP æœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±å¯ä»¥è¢«å…¶ä»–èŠ‚ç‚¹è®¿é—®ã€‚





### ä¸€è‡´æ€§å“ˆå¸Œ

ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯ron-cacheä»å•èŠ‚ç‚¹èµ°å‘åˆ†å¸ƒå¼èŠ‚ç‚¹çš„ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ã€‚





### åˆ†å¸ƒå¼èŠ‚ç‚¹

- æ³¨å†ŒèŠ‚ç‚¹(Register Peers)ï¼Œå€ŸåŠ©ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é€‰æ‹©èŠ‚ç‚¹ã€‚
- å®ç° HTTP å®¢æˆ·ç«¯ï¼Œä¸è¿œç¨‹èŠ‚ç‚¹çš„æœåŠ¡ç«¯é€šä¿¡ã€‚





### é˜²æ­¢ç¼“å­˜å‡»ç©¿

#### ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ä¸ç¼“å­˜ç©¿é€

- ==ç¼“å­˜å‡»ç©¿==ï¼šä¸€ä¸ªå­˜åœ¨çš„keyï¼Œåœ¨ç¼“å­˜è¿‡æœŸçš„ä¸€åˆ»ï¼ŒåŒæ—¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šå‡»ç©¿åˆ° DB ï¼Œé€ æˆç¬æ—¶DBè¯·æ±‚é‡å¤§ã€å‹åŠ›éª¤å¢ã€‚ã€çƒ­ç‚¹æ•°æ®ã€‘

- ==ç¼“å­˜ç©¿é€==ï¼šæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œå› ä¸ºä¸å­˜åœ¨åˆ™ä¸ä¼šå†™åˆ°ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šå»è¯·æ±‚ DBï¼Œå¦‚æœç¬é—´æµé‡è¿‡å¤§ï¼Œç©¿é€åˆ° DBï¼Œå¯¼è‡´å®•æœºã€‚

- ==ç¼“å­˜é›ªå´©==ï¼šç¼“å­˜åœ¨åŒä¸€æ—¶åˆ»å…¨éƒ¨å¤±æ•ˆï¼Œé€ æˆç¬æ—¶DBè¯·æ±‚é‡å¤§ã€å‹åŠ›éª¤å¢ï¼Œå¼•èµ·é›ªå´©ã€‚ç¼“å­˜é›ªå´©é€šå¸¸å› ä¸ºç¼“å­˜æœåŠ¡å™¨å®•æœºã€ç¼“å­˜çš„ key è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ç­‰å¼•èµ·ã€‚



### ä½¿ç”¨Protobufé€šä¿¡

#### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ protobuf

protobuf å³ Protocol Buffersï¼ŒGoogle å¼€å‘çš„ä¸€ç§æ•°æ®æè¿°è¯­è¨€ï¼Œæ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œä¸è¯­è¨€ã€å¹³å°æ— å…³ï¼Œå¯æ‰©å±•å¯åºåˆ—åŒ–ã€‚protobuf ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œå ç”¨ç©ºé—´å°ã€‚

ğŸ”–





## 3 ORMæ¡†æ¶ron-orm

### å…³äºORMæ¡†æ¶

å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆObject Relational Mappingï¼Œç®€ç§°ORMï¼‰æ˜¯é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼Œå°†é¢å‘å¯¹è±¡è¯­è¨€ç¨‹åºä¸­çš„å¯¹è±¡è‡ªåŠ¨æŒä¹…åŒ–åˆ°å…³ç³»æ•°æ®åº“ä¸­ã€‚

å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„å…³ç³»ï¼š

| æ•°æ®åº“              | é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€  |
| :------------------ | :------------------ |
| è¡¨(table)           | ç±»(class/struct)    |
| è®°å½•(record, row)   | å¯¹è±¡ (object)       |
| å­—æ®µ(field, column) | å¯¹è±¡å±æ€§(attribute) |

```sql
CREATE TABLE `User` (`Name` text, `Age` integer);
INSERT INTO `User` (`Name`, `Age`) VALUES ("Tom", 18);
SELECT * FROM `User`;
```

```go
type User struct {
    Name string
    Age  int
}

orm.CreateTable(&User{})
orm.Save(&User{"Tom", 18})
var users []User
orm.Find(&users)
```

ORM æ¡†æ¶ç›¸å½“äºå¯¹è±¡å’Œæ•°æ®åº“ä¸­é—´çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œå€ŸåŠ© ORM å¯ä»¥é¿å…å†™ç¹ççš„ SQL è¯­è¨€ï¼Œä»…ä»…é€šè¿‡æ“ä½œå…·ä½“çš„å¯¹è±¡ï¼Œå°±èƒ½å¤Ÿå®Œæˆå¯¹å…³ç³»å‹æ•°æ®åº“çš„æ“ä½œã€‚

> å¦‚ä½•å®ç°ä¸€ä¸ª ORM æ¡†æ¶å‘¢ï¼Ÿ

- `CreateTable` æ–¹æ³•éœ€è¦ä»å‚æ•° `&User{}` å¾—åˆ°å¯¹åº”çš„ç»“æ„ä½“çš„åç§° User ä½œä¸ºè¡¨åï¼Œæˆå‘˜å˜é‡ Name, Age ä½œä¸ºåˆ—åï¼ŒåŒæ—¶è¿˜éœ€è¦çŸ¥é“æˆå‘˜å˜é‡å¯¹åº”çš„ç±»å‹ã€‚
- `Save` æ–¹æ³•åˆ™éœ€è¦çŸ¥é“æ¯ä¸ªæˆå‘˜å˜é‡çš„å€¼ã€‚
- `Find` æ–¹æ³•ä»…ä»ä¼ å…¥çš„ç©ºåˆ‡ç‰‡ `&[]User`ï¼Œå¾—åˆ°å¯¹åº”çš„ç»“æ„ä½“åä¹Ÿå°±æ˜¯è¡¨å Userï¼Œå¹¶ä»æ•°æ®åº“ä¸­å–åˆ°æ‰€æœ‰çš„è®°å½•ï¼Œå°†å…¶è½¬æ¢æˆ User å¯¹è±¡ï¼Œæ·»åŠ åˆ°åˆ‡ç‰‡ä¸­ã€‚

å¦‚æœè¿™äº›æ–¹æ³•åªæ¥å— User ç±»å‹çš„å‚æ•°ï¼Œé‚£æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚ä½†æ˜¯ ORM æ¡†æ¶æ˜¯é€šç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å°†ä»»æ„åˆæ³•çš„å¯¹è±¡è½¬æ¢æˆæ•°æ®åº“ä¸­çš„è¡¨å’Œè®°å½•ã€‚ä¾‹å¦‚ï¼š

```go
type Account struct {
    Username string
    Password string
}

orm.CreateTable(&Account{})
```

> é—®é¢˜ï¼šå¦‚ä½•æ ¹æ®ä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œå¾—åˆ°å…¶å¯¹åº”çš„ç»“æ„ä½“çš„ä¿¡æ¯ã€‚

é€šè¿‡åå°„æœºåˆ¶(reflect)ï¼Œå¯ä»¥è·å–åˆ°å¯¹è±¡å¯¹åº”çš„ç»“æ„ä½“åç§°ï¼Œæˆå‘˜å˜é‡ã€æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

```go
typ := reflect.Indirect(reflect.ValueOf(&Account{})).Type()
fmt.Println(typ.Name()) // Account

for i := 0; i < typ.NumField(); i++ {
    field := typ.Field(i)
    fmt.Println(field.Name) // Username Password
}
```

- `reflect.ValueOf()` è·å–æŒ‡é’ˆå¯¹åº”çš„åå°„å€¼ã€‚
- `reflect.Indirect()` è·å–æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„åå°„å€¼ã€‚
- `(reflect.Type).Name()` è¿”å›ç±»å(å­—ç¬¦ä¸²)ã€‚
- `(reflect.Type).Field(i)` è·å–ç¬¬ i ä¸ªæˆå‘˜å˜é‡ã€‚

> é™¤äº†å¯¹è±¡å’Œè¡¨ç»“æ„/è®°å½•çš„æ˜ å°„ä»¥å¤–ï¼Œè®¾è®¡ ORM æ¡†æ¶è¿˜éœ€è¦å…³æ³¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

1. MySQLï¼ŒPostgreSQLï¼ŒSQLite ç­‰æ•°æ®åº“çš„ SQL è¯­å¥æ˜¯æœ‰åŒºåˆ«çš„ï¼ŒORM æ¡†æ¶å¦‚ä½•åœ¨å¼€å‘è€…ä¸æ„ŸçŸ¥çš„æƒ…å†µä¸‹é€‚é…å¤šç§æ•°æ®åº“ï¼Ÿ
2. å¦‚æœå¯¹è±¡çš„å­—æ®µå‘ç”Ÿæ”¹å˜ï¼Œæ•°æ®åº“è¡¨ç»“æ„èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ï¼Œå³æ˜¯å¦æ”¯æŒæ•°æ®åº“è‡ªåŠ¨è¿ç§»(migrate)ï¼Ÿ
3. æ•°æ®åº“æ”¯æŒçš„åŠŸèƒ½å¾ˆå¤šï¼Œä¾‹å¦‚äº‹åŠ¡(transaction)ï¼ŒORMæ¡†æ¶èƒ½å®ç°å“ªäº›ï¼Ÿ
4. ...



#### å…³äºron-orm

æ•°æ®åº“çš„ç‰¹æ€§éå¸¸å¤šï¼Œç®€å•çš„å¢åˆ æŸ¥æ”¹ä½¿ç”¨ ORM æ›¿ä»£ SQL è¯­å¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šç‰¹æ€§éš¾ä»¥ç”¨ ORM æ›¿ä»£ï¼Œæ¯”å¦‚å¤æ‚çš„å¤šè¡¨å…³è”æŸ¥è¯¢ï¼ŒORM ä¹Ÿå¯èƒ½æ”¯æŒï¼Œä½†æ˜¯åŸºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œå¼€å‘è€…è‡ªå·±å†™ SQL è¯­å¥å¾ˆå¯èƒ½æ›´é«˜æ•ˆã€‚

å› æ­¤ï¼Œè®¾è®¡å®ç°ä¸€ä¸ª ORM æ¡†æ¶ï¼Œå°±éœ€è¦ç»™åŠŸèƒ½ç‰¹æ€§æ’ä¼˜å…ˆçº§äº†ã€‚

https://github.com/go-gorm/gorm

### database/sqlåŸºç¡€



#### database/sql æ ‡å‡†åº“

- `Exec()` ç”¨äºæ‰§è¡Œ SQL è¯­å¥ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢è¯­å¥ï¼Œä¸ä¼šè¿”å›ç›¸å…³çš„è®°å½•ã€‚æ‰€ä»¥æŸ¥è¯¢è¯­å¥é€šå¸¸ä½¿ç”¨ `Query()` å’Œ `QueryRow()`ï¼Œå‰è€…å¯ä»¥è¿”å›å¤šæ¡è®°å½•ï¼Œåè€…åªè¿”å›ä¸€æ¡è®°å½•ã€‚
- `Exec()`ã€`Query()`ã€`QueryRow()` æ¥å—1æˆ–å¤šä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªå…¥å‚æ˜¯ SQL è¯­å¥ï¼Œåé¢çš„å…¥å‚æ˜¯ SQL è¯­å¥ä¸­çš„å ä½ç¬¦ `?` å¯¹åº”çš„å€¼ï¼Œå ä½ç¬¦ä¸€èˆ¬ç”¨æ¥é˜² SQL æ³¨å…¥ã€‚



#### å®ç°ä¸€ä¸ªç®€å•çš„ log åº“

å¼€å‘ä¸€ä¸ªæ¡†æ¶/åº“å¹¶ä¸å®¹æ˜“ï¼Œè¯¦ç»†çš„æ—¥å¿—èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°å®šä½é—®é¢˜ã€‚

log æ ‡å‡†åº“æ²¡æœ‰æ—¥å¿—åˆ†çº§ï¼Œä¸æ‰“å°æ–‡ä»¶å’Œè¡Œå·ã€‚



### å¯¹è±¡è¡¨ç»“æ„æ˜ å°„

- ä½¿ç”¨ dialect éš”ç¦»ä¸åŒæ•°æ®åº“ä¹‹é—´çš„å·®å¼‚ï¼Œä¾¿äºæ‰©å±•ã€‚
- ä½¿ç”¨åå°„(reflect)è·å–ä»»æ„ struct å¯¹è±¡çš„åç§°å’Œå­—æ®µï¼Œæ˜ å°„ä¸ºæ•°æ®ä¸­çš„è¡¨ã€‚
- æ•°æ®åº“è¡¨çš„åˆ›å»º(create)ã€åˆ é™¤(drop)ã€‚

#### 1ï¸âƒ£Dialect

SQL è¯­å¥ä¸­çš„ç±»å‹å’Œ Go è¯­è¨€ä¸­çš„ç±»å‹æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚Go è¯­è¨€ä¸­çš„ `int`ã€`int8`ã€`int16` ç­‰ç±»å‹å‡å¯¹åº” SQLite ä¸­çš„ `integer` ç±»å‹ã€‚å› æ­¤å®ç° ORM æ˜ å°„çš„ç¬¬ä¸€æ­¥ï¼Œéœ€è¦æ€è€ƒå¦‚ä½•å°† Go è¯­è¨€çš„ç±»å‹æ˜ å°„ä¸ºæ•°æ®åº“ä¸­çš„ç±»å‹ã€‚

åŒæ—¶ï¼Œä¸åŒæ•°æ®åº“æ”¯æŒçš„æ•°æ®ç±»å‹ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„ï¼Œå³ä½¿åŠŸèƒ½ç›¸åŒï¼Œåœ¨ SQL è¯­å¥çš„è¡¨è¾¾ä¸Šä¹Ÿå¯èƒ½æœ‰å·®å¼‚ã€‚ORM æ¡†æ¶å¾€å¾€éœ€è¦å…¼å®¹å¤šç§æ•°æ®åº“ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†å·®å¼‚çš„è¿™ä¸€éƒ¨åˆ†æå–å‡ºæ¥ï¼Œæ¯ä¸€ç§æ•°æ®åº“åˆ†åˆ«å®ç°ï¼Œå®ç°æœ€å¤§ç¨‹åº¦çš„å¤ç”¨å’Œè§£è€¦ã€‚è¿™éƒ¨åˆ†ä»£ç ç§°ä¹‹ä¸º `dialect`ã€‚



#### 2ï¸âƒ£Schema

å¯¹è±¡(object)å’Œè¡¨(table)çš„è½¬æ¢





#### 3ï¸âƒ£Session

Session çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ•°æ®åº“è¡¨çš„å¢/åˆ æ“ä½œå®ç°åœ¨å­åŒ… session ä¸­ã€‚





### è®°å½•æ–°å¢å’ŒæŸ¥è¯¢

- å®ç°æ–°å¢(insert)è®°å½•çš„åŠŸèƒ½ã€‚
- ä½¿ç”¨åå°„(reflect)å°†æ•°æ®åº“çš„è®°å½•è½¬æ¢ä¸ºå¯¹åº”çš„ç»“æ„ä½“å®ä¾‹ï¼Œå®ç°æŸ¥è¯¢(select)åŠŸèƒ½ã€‚

#### 1ï¸âƒ£Clauseæ„é€ SQLè¯­å¥



#### 2ï¸âƒ£InsertåŠŸèƒ½



åç»­æ‰€æœ‰æ„é€  SQL è¯­å¥çš„æ–¹å¼éƒ½å°†ä¸ `Insert` ä¸­æ„é€  SQL è¯­å¥çš„æ–¹å¼ä¸€è‡´ã€‚åˆ†ä¸¤æ­¥ï¼š

1. å¤šæ¬¡è°ƒç”¨ `clause.Set()` æ„é€ å¥½æ¯ä¸€ä¸ªå­å¥ã€‚
2. è°ƒç”¨ä¸€æ¬¡ `clause.Build()` æŒ‰ç…§ä¼ å…¥çš„é¡ºåºæ„é€ å‡ºæœ€ç»ˆçš„ SQL è¯­å¥ã€‚

æ„é€ å®Œæˆåï¼Œè°ƒç”¨ `Raw().Exec()` æ–¹æ³•æ‰§è¡Œã€‚



#### 3ï¸âƒ£FindåŠŸèƒ½



### é“¾å¼æ“ä½œä¸æ›´æ–°åˆ é™¤

- é€šè¿‡é“¾å¼(chain)æ“ä½œï¼Œæ”¯æŒæŸ¥è¯¢æ¡ä»¶(where, order by, limit ç­‰)çš„å åŠ ã€‚
- å®ç°è®°å½•çš„æ›´æ–°(update)ã€åˆ é™¤(delete)å’Œç»Ÿè®¡(count)åŠŸèƒ½ã€‚



### å®ç°é’©å­

- é€šè¿‡åå°„(reflect)è·å–ç»“æ„ä½“ç»‘å®šçš„é’©å­(hooks)ï¼Œå¹¶è°ƒç”¨ã€‚
- æ”¯æŒå¢åˆ æŸ¥æ”¹(CRUD)å‰åè°ƒç”¨é’©å­ã€‚

#### Hook æœºåˆ¶

Hookï¼Œç¿»è¯‘ä¸ºé’©å­ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯æå‰åœ¨å¯èƒ½å¢åŠ åŠŸèƒ½çš„åœ°æ–¹åŸ‹å¥½(é¢„è®¾)ä¸€ä¸ªé’©å­ï¼Œå½“æˆ‘ä»¬éœ€è¦é‡æ–°ä¿®æ”¹æˆ–è€…å¢åŠ è¿™ä¸ªåœ°æ–¹çš„é€»è¾‘çš„æ—¶å€™ï¼ŒæŠŠæ‰©å±•çš„ç±»æˆ–è€…æ–¹æ³•æŒ‚è½½åˆ°è¿™ä¸ªç‚¹å³å¯ã€‚é’©å­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚ Github æ”¯æŒçš„ travis æŒç»­é›†æˆæœåŠ¡ï¼Œå½“æœ‰ `git push` äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šè§¦å‘ travis æ‹‰å–æ–°çš„ä»£ç è¿›è¡Œæ„å»ºã€‚IDE ä¸­é’©å­ä¹Ÿéå¸¸å¸¸è§ï¼Œæ¯”å¦‚ï¼Œå½“æŒ‰ä¸‹ `Ctrl + s` åï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚å†æ¯”å¦‚å‰ç«¯å¸¸ç”¨çš„ `hot reload` æœºåˆ¶ï¼Œå‰ç«¯ä»£ç å‘ç”Ÿå˜æ›´æ—¶ï¼Œè‡ªåŠ¨ç¼–è¯‘æ‰“åŒ…ï¼Œé€šçŸ¥æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œå®ç°æ‰€å†™å³æ‰€å¾—ã€‚

é’©å­æœºåˆ¶è®¾è®¡çš„å¥½åï¼Œå–å†³äºæ‰©å±•ç‚¹é€‰æ‹©çš„æ˜¯å¦åˆé€‚ã€‚ä¾‹å¦‚å¯¹äºæŒç»­é›†æˆæ¥è¯´ï¼Œä»£ç å¦‚æœä¸å‘ç”Ÿå˜æ›´ï¼Œåå¤æ„å»ºæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤é’©å­åº”è®¾è®¡åœ¨ä»£ç å¯èƒ½å‘ç”Ÿå˜æ›´çš„åœ°æ–¹ï¼Œæ¯”å¦‚ MRã€PR åˆå¹¶å‰åã€‚

é‚£å¯¹äº ORM æ¡†æ¶æ¥è¯´ï¼Œåˆé€‚çš„æ‰©å±•ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œè®°å½•çš„å¢åˆ æŸ¥æ”¹å‰åéƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª `Account` ç±»ï¼Œ`Account` åŒ…å«æœ‰ä¸€ä¸ªéšç§å­—æ®µ `Password`ï¼Œé‚£ä¹ˆæ¯æ¬¡æŸ¥è¯¢åéƒ½éœ€è¦åšè„±æ•å¤„ç†ï¼Œæ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚å¦‚æœæä¾›äº† `AfterQuery` çš„é’©å­ï¼ŒæŸ¥è¯¢åï¼Œè‡ªåŠ¨åœ°å°† `Password` å­—æ®µçš„å€¼è„±æ•ï¼Œæ˜¯ä¸æ˜¯èƒ½çœå»å¾ˆå¤šå†—ä½™çš„ä»£ç å‘¢ï¼Ÿ



### æŒäº‹åŠ¡



#### SQLiteå’ŒGoæ ‡å‡†åº“ä¸­çš„äº‹åŠ¡





### æ•°æ®åº“è¿ç§»

- ç»“æ„ä½“(struct)å˜æ›´æ—¶ï¼Œæ•°æ®åº“è¡¨çš„å­—æ®µ(field)è‡ªåŠ¨è¿ç§»(migrate)ã€‚
- ä»…æ”¯æŒå­—æ®µæ–°å¢ä¸åˆ é™¤ï¼Œä¸æ”¯æŒå­—æ®µç±»å‹å˜æ›´ã€‚



## 4 RPCæ¡†æ¶ron-rpc

> RPCæ˜¯ä»€ä¹ˆ

RPC(Remote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨)æ˜¯ä¸€ç§è®¡ç®—æœºé€šä¿¡åè®®ï¼Œå…è®¸è°ƒç”¨ä¸åŒè¿›ç¨‹ç©ºé—´çš„ç¨‹åºã€‚RPCçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚ç¨‹åºå‘˜ä½¿ç”¨æ—¶ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°ç¨‹åºä¸€æ ·ï¼Œæ— éœ€å…³æ³¨å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚

ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å¹¿æ³›ä½¿ç”¨çš„åŸºäº HTTP åè®®çš„ Restful APIã€‚ä¸ RPC ç›¸æ¯”ï¼ŒRestful API æœ‰ç›¸å¯¹ç»Ÿä¸€çš„æ ‡å‡†ï¼Œå› è€Œæ›´**é€šç”¨ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼Œæ”¯æŒä¸åŒçš„è¯­è¨€**ã€‚HTTP åè®®æ˜¯åŸºäº**æ–‡æœ¬**çš„ï¼Œä¸€èˆ¬å…·å¤‡æ›´å¥½çš„å¯è¯»æ€§ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼ŒRPCå’Œ Restful APIå¯¹æ¯”ï¼š

- Restful æ¥å£éœ€è¦é¢å¤–çš„å®šä¹‰ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œéƒ½éœ€è¦**é¢å¤–çš„ä»£ç **æ¥å¤„ç†ï¼Œè€Œ RPC è°ƒç”¨åˆ™æ›´æ¥è¿‘äºç›´æ¥è°ƒç”¨ã€‚
- åŸºäº HTTP åè®®çš„ Restful æŠ¥æ–‡å†—ä½™ï¼Œæ‰¿è½½äº†è¿‡å¤šçš„æ— æ•ˆä¿¡æ¯ï¼Œè€Œ RPC é€šå¸¸ä½¿ç”¨**è‡ªå®šä¹‰çš„åè®®æ ¼å¼ï¼Œå‡å°‘å†—ä½™æŠ¥æ–‡**ã€‚
- RPC å¯ä»¥é‡‡ç”¨æ›´é«˜æ•ˆçš„åºåˆ—åŒ–åè®®ï¼Œå°†==æ–‡æœ¬==è½¬ä¸º**==äºŒè¿›åˆ¶==**ä¼ è¾“ï¼Œè·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚
- å› ä¸º RPC çš„çµæ´»æ€§ï¼Œæ‰€ä»¥æ›´å®¹æ˜“æ‰©å±•å’Œé›†æˆè¯¸å¦‚æ³¨å†Œä¸­å¿ƒã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚

> RPCæ¡†æ¶éœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿæˆ–è€…è¯´ï¼Œä¸ºä»€ä¹ˆéœ€è¦RPCæ¡†æ¶ï¼Ÿ

ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡é‡‡ç”¨çš„ä¼ è¾“åè®®ï¼š

- ä½äºä¸åŒçš„æœºå™¨ï¼Œä¸€èˆ¬ä¼šé€‰æ‹© TCP åè®®æˆ–è€… HTTP åè®®ï¼›
- ä½äºç›¸åŒçš„æœºå™¨ï¼Œé€‰æ‹© Unix Socket åè®®

æŠ¥æ–‡çš„ç¼–ç æ ¼å¼ï¼š

- æœ€å¸¸ç”¨çš„ JSON æˆ–è€… XMLï¼›
- æŠ¥æ–‡æ¯”è¾ƒå¤§ï¼Œå¯èƒ½ä¼šé€‰æ‹© protobuf ç­‰ï¼›
- å‘é€ç«¯ç¼–ç ä¹‹åï¼Œå†è¿›è¡Œå‹ç¼©ï¼›æ¥æ”¶ç«¯è·å–æŠ¥æ–‡ï¼Œå…ˆè§£å‹å†è§£ç ã€‚

è§£å†³ä¸€ç³»åˆ—çš„å¯ç”¨æ€§é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œ**è¿æ¥è¶…æ—¶äº†æ€ä¹ˆåŠï¼Ÿæ˜¯å¦æ”¯æŒå¼‚æ­¥è¯·æ±‚å’Œå¹¶å‘ï¼Ÿ**

å¦‚æœæœåŠ¡ç«¯çš„å®ä¾‹å¾ˆå¤šï¼Œå®¢æˆ·ç«¯å¹¶ä¸å…³å¿ƒè¿™äº›å®ä¾‹çš„**åœ°å€å’Œéƒ¨ç½²ä½ç½®**ï¼Œåªå…³å¿ƒè‡ªå·±èƒ½å¦è·å–åˆ°æœŸå¾…çš„**ç»“æœ**ï¼Œé‚£å°±å¼•å‡ºäº†==æ³¨å†Œä¸­å¿ƒ(registry)==å’Œ==è´Ÿè½½å‡è¡¡(load balance)==çš„é—®é¢˜ã€‚ç®€å•åœ°è¯´ï¼Œå³å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº’ç›¸ä¸æ„ŸçŸ¥å¯¹æ–¹çš„å­˜åœ¨ï¼ŒæœåŠ¡ç«¯å¯åŠ¨æ—¶å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯è°ƒç”¨æ—¶ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–åˆ°æ‰€æœ‰å¯ç”¨çš„å®ä¾‹ï¼Œé€‰æ‹©ä¸€ä¸ªæ¥è°ƒç”¨ã€‚è¿™æ ·æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åªéœ€è¦æ„ŸçŸ¥æ³¨å†Œä¸­å¿ƒçš„å­˜åœ¨å°±å¤Ÿäº†ã€‚æ³¨å†Œä¸­å¿ƒé€šå¸¸è¿˜éœ€è¦å®ç°**æœåŠ¡åŠ¨æ€æ·»åŠ ã€åˆ é™¤**ï¼Œä½¿ç”¨**å¿ƒè·³**ç¡®ä¿æœåŠ¡å¤„äºå¯ç”¨çŠ¶æ€ç­‰åŠŸèƒ½ã€‚

å†è¿›ä¸€æ­¥ï¼Œå‡è®¾æœåŠ¡ç«¯æ˜¯ä¸åŒçš„å›¢é˜Ÿæä¾›çš„ï¼Œå¦‚æœæ²¡æœ‰ç»Ÿä¸€çš„ RPC æ¡†æ¶ï¼Œå„ä¸ªå›¢é˜Ÿçš„æœåŠ¡æä¾›æ–¹å°±éœ€è¦å„è‡ªå®ç°ä¸€å¥—**æ¶ˆæ¯ç¼–è§£ç ã€è¿æ¥æ± ã€æ”¶å‘çº¿ç¨‹ã€è¶…æ—¶å¤„ç†**ç­‰â€œä¸šåŠ¡ä¹‹å¤–â€çš„é‡å¤æŠ€æœ¯åŠ³åŠ¨ï¼Œé€ æˆæ•´ä½“çš„ä½æ•ˆã€‚å› æ­¤ï¼Œâ€œä¸šåŠ¡ä¹‹å¤–â€çš„è¿™éƒ¨åˆ†å…¬å…±çš„èƒ½åŠ›ï¼Œå³æ˜¯ RPC æ¡†æ¶æ‰€éœ€è¦å…·å¤‡çš„èƒ½åŠ›ã€‚

> ron-rpc

æˆç†Ÿçš„RPCæ¡†æ¶å’Œå¾®æœåŠ¡æ¡†æ¶å¾ˆå¤šï¼š`grpc`ã€`rpcx`ã€`go-micro` ç­‰

ä»¥Goè¯­è¨€å®˜æ–¹çš„æ ‡å‡†åº“`net/rpc`ä¸ºåŸºç¡€ï¼Œæ–°å¢åè®®äº¤æ¢(protocol exchange)ã€æ³¨å†Œä¸­å¿ƒ(registry)ã€æœåŠ¡å‘ç°(service discovery)ã€è´Ÿè½½å‡è¡¡(load balance)ã€è¶…æ—¶å¤„ç†(timeout processing)ç­‰ç‰¹æ€§ã€‚

### æœåŠ¡ç«¯ä¸æ¶ˆæ¯ç¼–ç 

#### æ¶ˆæ¯çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–



#### é€šä¿¡è¿‡ç¨‹



```
| Option{MagicNumber: xxx, CodecType: xxx} | Header{ServiceMethod ...} | Body interface{} |
| <------      å›ºå®š JSON ç¼–ç       ------>  | <-------   ç¼–ç æ–¹å¼ç”± CodeType å†³å®š   ------->|
```



```
| Option | Header1 | Body1 | Header2 | Body2 | ...
```

